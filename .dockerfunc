#!/bin/bash

# Helper Functions
dcleanup(){
  docker rm $(docker ps --filter status=exited -q 2>/dev/null) 2>/dev/null
  docker rmi $(docker images --filter dangling=true -q 2>/dev/null) 2>/dev/null
}

del_stopped(){
  local name=$1
  local state=$(docker inspect --format "{{.State.Running}}" $name 2>/dev/null)

  if [[ "$state" == "false" ]]; then
    docker rm $name
  fi
}

# Container Aliases
composer() {
  docker run --rm -it \
    -v $(pwd):/app \
    jdecool/composer "$@"
}

jekyll() {
  docker run --rm -it \
    -v $(pwd):/srv/jekyll \
    -p 127.0.0.1:4000:4000 \
    jdecool/jekyll jekyll "$@"
}

keepass2() {
  del_stopped keepass2

  docker run -d \
    -v /tmp/.X11-unix:/tmp/.X11-unix \
    -v $HOME/Documents:/root/Documents \
    -e DISPLAY=unix$DISPLAY \
    --name keepass2 \
    jdecool/keepass2 "$@"
}

pgadmin() {
  del_stopped pgadmin

  docker run -d \
    --net host \
    -v /tmp/.X11-unix:/tmp/.X11-unix \
    -e DISPLAY=unix$DISPLAY \
    --name pgadmin \
    jdecool/pgadmin "$@"
}

postgres() {
  del_stopped postgres

  docker run -d \
    -e POSTGRES_PASSWORD=root \
    -p 127.0.0.1:5432:5432 \
    postgres
}
